# 操作系统挑战性任务实验报告

# 一行多命令

# 后台任务

# 引号支持
~~aaa~~
~~杨博文~~
<u>aaayang<br/>bo</u>
# 不用.b

解析字符串的原理 提前已经在每个token结尾置上了0

写了strstr函数，不能直接在原字符串上修改，因为会影响到后续的参数，新开一个数组改造argv

# 光标

长度会变长？backspace就没事 ？？
个人猜测 输入逻辑：输入的字符会输出到显示屏的光标处，\b的acaii码是8，但是若想移动光标(后退或者前进)，输出acaii码的值是不行的，必须直接输出\b。

不打印\b的话，表面光标没有退回 但实际退回了 back是127，<-是271？

<- 27  91  68 三个字符
-> 27  91  67 三个字符 要往后回退三个才可以 组合字符 第一次见 学到了

简单的回退未必成功 <- , 所以维护一个指针和最大值 分两个Buf处理 一个是真正的输入流 一个是字符串流

# history

文件指针问题 会覆盖 想办法

up 27 91 65
down 27 91 66
若指令没有 则根本不会被装进历史记录中
上下的逻辑有些许问题 回去调整

sizeof和 strlen不一样 千万不要搞混

# 重定向

重定向输出有问题 不能用creat？

creat创造出的文件不可以写 因为没设置写位 先create再关闭 再打开即可 统一使用read write，然后根据fd设备的不同分配给不同的写函数

# tree
按层次遍历 注意层的深度加减

# mkdir
实现哪种呢？只是创建第一层 还是能根据路径创建好多文件夹
-p 实现多级创建
无 单级创建
用户态实现mkdir
# touch
无单级创建
-p 多级创建
# create
目录必须存在 才能创建文件

什么时候该和文件系统交互 
什么时候直接读取文件 递归就行 tree

给目录里写东西应当不被允许 加一些限制 比如打开文件时路径必须对应REG 否则报错

带/绝对路径
不带/相对路径
进程控制块中添加属性 工作目录

getcwd() 获得当前工作目录

chdir() 改变当前目录

strcpy？？？为何会出现怪问题

down里面输出touch 
buf里面变成了 touc

# 环境变量

字符串到字符串的映射 struct 是否只读, name, value
局部变量
记录全局，局部的数量

全局变量 字符串指针 不能指向一个局部变量指针

如何定义全局变量捏

执行新一条命令时不会保留这个全局变量

全局 内核数组 在内核态改变 维护struct 所有shell可见

局部变量 设置envid判断 shid 每个sh独有一个 局部变量根据shid来判断 如何传递shid 可以当成内部命令

进程控制块中维护shid 每当sh时shid＋＋

命令都是用户态程序 全局变量也是在用户态

局部变量重名问题

## 控制台基本规律
1. 输出一个字符就在光标处的原本字符替换为该字符 且光标前移一个，控制符包括\0不会改变光标位置
2. right left只会让光标左移右移
3. 上键光标会往上一格 而下键不会往下一格
将控制台改造成linux 正常人习惯用的那样

## 注意debugf printf

内核态 printk 无法重定向 

sizeof strlen的区别
memcpy strcpy区别
## 路径切换
实现cd .. 和 .

## 总结 实现的功能

一行多命令 ；
后台任务(读入下一行请求导致阻塞未执行完的请求) &
引号支持 没有考虑转义 可以改一下
**光标的修改** 使其与linux正常模式保持一致 删除与增加 左右移
.b的省略
更丰富的命令：
    tree 是否有其他好实现的参数
    touch -p 支持..
    mkdir -p 支持..
    cd 绝对路径 相对路径 .. .
    pwd
    declare -x -r
    unset
    history
    echo (-n 不输出换行) 正常输出\n
    cp -r
    mv -r
    rm 
    rmdir
重定向的改进 >> >应当都清
各种命令均支持绝对路径与相对路径
使用$转义环境变量
实现历史命令查阅 上下移 与左右移形成交互
a/../b 在我这会
其他函数的
每个实现依次讲述 附上源代码
各个层次的include.mk
磁盘初始化使用 fs-file userapps 指定的motd newmotd

rm：若是文件 则删除； -r 若是目录也可以删除；但若删除目录 则需要确认

rmdir: 删除空目录 -p 删除第一个路径下所有

为何无法正常读取
回车与\n不同 通常输入一个回车 输出一个\n


fs/fs.c关键函数

dir_lookup 查找当前目录下是否存在name的下级文件
dir_alloc_file 在当前目录下申请一个新的空的文件控制块
file_block_walk 同样找当前文件控制块i结点指向的第num个磁盘块的磁盘号 可申请一级索引块 若对应位置无指向则返回0
*file_map_block 当前文件控制块i结点指向的第num个磁盘块的磁盘块号 若为0 则申请一块
file_get_block 当前文件控制块i结点指向的第num个磁盘块的虚拟地址

矛盾 若提前解析好则不知道用不用-p

文件控制块 大小转变 压缩？

参数有关的异常可以在命令文件中就检验

mv 文件 -> 存在的文件 改写文件名
    文件 -> 存在的目录 放在目录底下
    文件 -> 不存在的路径 合法的情况下 默认touch文件 改写文件名
    目录 -> 不存在的路径 合法情况下 默认mkdir目录 改写目录名
    目录 -> 存在的目录 放在该目录底下
    目录 -> 存在的文件 非法

tab 9 空八个格